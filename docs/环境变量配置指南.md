# 环境变量配置指南

## 必需的环境变量

### 1. DashScope API Key（必需）
```bash
export DASHSCOPE_API_KEY="your_dashscope_api_key_here"
```

### 2. MySQL 数据库配置（必需）
```bash
export MYSQL_HOST="localhost"
export MYSQL_PORT="3306"
export MYSQL_DATABASE="trip_dog"
export MYSQL_USERNAME="root"
export MYSQL_PASSWORD="your_password"
```

### 3. Redis 配置（必需）
```bash
export REDIS_HOST="localhost"
export REDIS_PORT="6379"
export REDIS_PASSWORD=""  # 如果无密码则留空
export REDIS_DATABASE="0"
```

### 4. MinIO 配置（必需）
```bash
export MINIO_ENDPOINT="http://localhost:9000"
export MINIO_PORT="9000"
export MINIO_AK="your_access_key"
export MINIO_SK="your_secret_key"
```

### 5. PostgreSQL + pgvector（可选，用于文档向量存储）
```bash
export PGVECTOR_HOST="localhost"
export PGVECTOR_PORT="5432"
export PGVECTOR_DATABASE="trip_dog_vector"
export PGVECTOR_USER="postgres"
export PGVECTOR_PASSWORD="your_password"
export PGVECTOR_TABLE="document_embeddings"
```

### 6. 邮件配置（可选，用于邮箱验证码）
```bash
export MAIL_HOST="smtp.qq.com"
export MAIL_PORT="465"
export MAIL_USERNAME="your_email@qq.com"
export MAIL_PASSWORD="your_email_password"
```

## 快速配置方法

### 方法1：创建 .env 文件（推荐）

在项目根目录创建 `.env` 文件：

```bash
cd /projects/trip_doge
cat > .env << 'EOF'
# DashScope API Key
DASHSCOPE_API_KEY=your_dashscope_api_key_here

# MySQL
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_DATABASE=trip_dog
MYSQL_USERNAME=root
MYSQL_PASSWORD=your_password

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DATABASE=0

# MinIO
MINIO_ENDPOINT=http://localhost:9000
MINIO_PORT=9000
MINIO_AK=your_access_key
MINIO_SK=your_secret_key

# PostgreSQL (可选)
PGVECTOR_HOST=localhost
PGVECTOR_PORT=5432
PGVECTOR_DATABASE=trip_dog_vector
PGVECTOR_USER=postgres
PGVECTOR_PASSWORD=your_password
PGVECTOR_TABLE=document_embeddings

# Mail (可选)
MAIL_HOST=smtp.qq.com
MAIL_PORT=465
MAIL_USERNAME=your_email@qq.com
MAIL_PASSWORD=your_email_password
EOF
```

然后使用 `source .env` 或 `export $(cat .env | xargs)` 加载环境变量。

### 方法2：直接导出环境变量

```bash
export DASHSCOPE_API_KEY="your_key"
export MYSQL_HOST="localhost"
export MYSQL_DATABASE="trip_dog"
export MYSQL_USERNAME="root"
export MYSQL_PASSWORD="your_password"
# ... 其他变量
```

### 方法3：使用环境变量文件启动

```bash
# 创建 env.sh
cat > env.sh << 'EOF'
#!/bin/bash
export DASHSCOPE_API_KEY="your_key"
# ... 其他变量
EOF

# 启动时加载
source env.sh && mvn spring-boot:run
```

## 验证环境变量

运行以下命令检查环境变量是否已设置：

```bash
echo "DASHSCOPE_API_KEY: ${DASHSCOPE_API_KEY:-(未设置)}"
echo "MYSQL_HOST: ${MYSQL_HOST:-(未设置)}"
echo "MYSQL_DATABASE: ${MYSQL_DATABASE:-(未设置)}"
echo "REDIS_HOST: ${REDIS_HOST:-(未设置)}"
echo "MINIO_ENDPOINT: ${MINIO_ENDPOINT:-(未设置)}"
```

## 启动后端服务

配置好环境变量后，启动后端服务：

```bash
cd /projects/trip_doge
mvn spring-boot:run
```

或者打包后运行：

```bash
mvn clean package -DskipTests
java -jar target/tripdog-backend-1.0.0.jar
```

## 检查服务状态

启动后，检查服务是否正常运行：

```bash
# 健康检查
curl http://localhost:7979/api/actuator/health

# 应该返回类似：
# {"status":"UP"}
```

## 常见问题

### 1. 启动失败：Could not resolve placeholder 'DASHSCOPE_API_KEY'
**原因**: 环境变量未设置  
**解决**: 确保已设置所有必需的环境变量

### 2. 数据库连接失败
**原因**: MySQL未启动或配置错误  
**解决**: 
- 检查MySQL服务是否运行: `systemctl status mysql` 或 `service mysql status`
- 验证数据库是否存在: `mysql -u root -p -e "SHOW DATABASES;"`
- 检查连接信息是否正确

### 3. Redis连接失败
**原因**: Redis未启动或配置错误  
**解决**: 
- 检查Redis服务: `redis-cli ping`（应返回PONG）
- 验证密码是否正确

### 4. MinIO连接失败
**原因**: MinIO未启动或配置错误  
**解决**: 
- 检查MinIO服务是否运行
- 验证访问密钥和秘密密钥是否正确

## 开发环境最小配置

如果只是测试API修复，最小配置如下：

```bash
# 必需
export DASHSCOPE_API_KEY="your_key"
export MYSQL_HOST="localhost"
export MYSQL_DATABASE="trip_dog"
export MYSQL_USERNAME="root"
export MYSQL_PASSWORD="your_password"
export REDIS_HOST="localhost"
export REDIS_PORT="6379"
export REDIS_DATABASE="0"
export MINIO_ENDPOINT="http://localhost:9000"
export MINIO_AK="minioadmin"
export MINIO_SK="minioadmin"
```

注意：即使某些服务（如MinIO、Redis）未运行，后端也可能启动，但相关功能会不可用。



